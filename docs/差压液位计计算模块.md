# 差压液位计计算模块（Android）

## 功能概述
- 支持“差压液位计 / 双法兰液位计”的零点值与量程值计算
- 支持两种计算模式：
  - **密度 + 高度**：输入介质密度 ρ（kg/m³）与测量高度 H（m），计算零点与量程
  - **差压 + 高度**：输入差压 ΔP（kPa/mmH₂O/bar/Pa）与对应高度 H（m），自动反算介质密度并输出零点与量程
- 支持硅油密度单独配置（默认 950 kg/m³），并与介质密度区分
- 支持单位自动换算：kPa / Pa / bar / mmH₂O
- 保存最近 20 条计算历史记录（可清空）

## 计算模型与公式
### 基本公式
压力（或差压）：
- **P = ρ × g × h**
- 其中：g = 9.81 m/s²

### 量程与零点
设：
- ρ介质：被测介质密度（kg/m³）
- H：测量高度/量程高度（m）
- h0：零点迁移高度（m，输入高度值为正数；方向由“正/负迁移”开关决定）
- ρ硅油：毛细管填充液（硅油）密度（kg/m³，默认 950）
- hOil：硅油等效高度（m，默认 0；常用于双法兰毛细管静压差修正，等效为 h2 − h3；计算时取绝对值并由迁移方向决定正负）

则：
- **量程值（Span）**：SPAN = URV − LRV = ρ介质 × g × H
- **零点值（LRV）**：LRV = ±(ρ介质 × g × |h0| + ρ硅油 × g × |hOil|)（默认负迁移）
- **上限值（URV）**：URV = LRV + SPAN

### 量程反算（重新计算上下限，量程不变）
已知：
- 原量程上下限：LRV0、URV0（SPAN0 = URV0 − LRV0）
- 真实液位百分比：p（0–100%）
- 当前差压：ΔPnow

则：
- **新 LRV = ΔPnow − (p/100) × SPAN0**
- **新 URV = 新 LRV + SPAN0**
- **SPAN 保持不变**

## 使用说明（App 内）
### 1) 选择仪表类型
- **差压液位计**：只使用介质密度项计算
- **双法兰液位计**：可输入硅油密度与硅油等效高度，用于零点修正

### 2) 选择计算模式
- **密度+高度**：输入 ρ（kg/m³）、H（m），可选 h0、hOil
- **量程反算**：输入 LRV0/URV0、真实液位% 与当前差压 ΔPnow，输出新 LRV/URV（SPAN 不变）

### 3) 单位与输出
- 输出单位可在“输出单位”中选择：kPa / Pa / bar / mmH₂O
- 结果会在页面下方显示：零点值、量程值、反算密度

### 4) 历史记录
- 自动保存最近 20 条计算记录
- 可点击“清空历史”清空

## 安装场景向导
- 在“差压液位计计算”页右上角点击“安装向导”进入
- 向导按步骤收集参数：仪表类型、计算模式、H/h0、（双法兰）h2/h3 与硅油密度、单位选择
- 向导会自动保存进度（包括当前步骤与已完成步骤），下次打开可继续
- 在最后一步点击“应用”，会把向导参数自动填入计算页

## API（供其他模块调用）
核心 API 位于：
- `com.kidsafe.probe.dplevel.DpLevelCalculator`
- `com.kidsafe.probe.dplevel.PressureUnit`、`com.kidsafe.probe.dplevel.HeightUnit`

建议调用方式：
- 构造 `DpLevelInput`，调用 `DpLevelCalculator.compute(input)` 获取 `DpLevelResult`
